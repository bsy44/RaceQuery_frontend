<div class="table-responsive">
  @if (results.length) {
    <table class="race-table">
      <thead>
      <tr>
        <th class="col-pos center">Pos</th>
        <th class="col-driver">Pilote</th>
        <th class="col-team">Écurie</th>

        @if (isQualifying()) {
          <th class="col-time center">Q1</th>
          <th class="col-time center">Q2</th>
          <th class="col-time center">Q3</th>
          <th class="tyre">Pneus</th>
        }

        @if (isPractice()) {
          <th class="col-time center">Temps</th>
          <th class="col-laps center">Tours</th>
          <th class="tyre">Pneus</th>
        }


        @if (isRaceOrSprint()) {
          <th class="col-laps center">Tours</th>
          <th class="col-time center">Temps / Écart</th>
          <th class="tyre">Pneus</th>
          <th class="col-points">Pts</th>
        }
      </tr>
      </thead>

      <tbody>
        @for (r of results; track r.DriverNumber ?? r.position) {
          <tr class="data-row">

            <td class="cell-pos">
              <div class="pos-content">
                <span class="pos-number">{{ r.position }}</span>
                @if (isRaceOrSprint()) {
                  @if (r.evolution > 0) { <span class="evo up">▲ {{ r.evolution }}</span> }
                  @else if (r.evolution < 0) { <span class="evo down">▼ {{ Math.abs(r.evolution) }}</span> }
                }
              </div>
            </td>

            <td class="cell-driver" [style.border-left-color]="'#' + r.teamColor">
              <span class="driver-name">{{ r.driver }}</span>
              <span class="short-name">{{ r.last_name }}</span>
            </td>

            <td class="cell-team">
              <img src="/logos/{{ r.team_id }}.avif" alt="{{ r.team }}" class="team-logo-mini">
              <span class="team-name-short">{{ r.team }}</span>
            </td>

            @if (isQualifying()) {
              <td class="cell-time mono" [class.purple-sector]="r.q1 === bestQ1">{{ r.q1 || '-' }}</td>
              <td class="cell-time mono" [class.purple-sector]="r.q2 === bestQ2">{{ r.q2 || '-' }}</td>
              <td class="cell-time mono" [class.purple-sector]="r.q3 === bestQ3">{{ r.q3 || '-' }}</td>

              <td class="cell-tyre">
                @if (r.tyre) {
                  <div class="pirelli-tyre" [ngClass]="getTyreClass(r.tyre)" title="{{ r.tyre }}">
                    <span class="tyre-letter">{{ getTyreLetter(r.tyre) }}</span>
                  </div>
                } @else {
                  <span>-</span>
                }
              </td>            }

            @if (isPractice()) {
              <td class="cell-time mono">{{ r.time }}</td>
              <td class="cell-laps">{{ r.laps }}</td>

              <td class="cell-tyre">
                @if (r.tyre) {
                  <div class="pirelli-tyre" [ngClass]="getTyreClass(r.tyre)" title="{{ r.tyre }}">
                    <span class="tyre-letter">{{ getTyreLetter(r.tyre) }}</span>
                  </div>
                } @else {
                  <span>-</span>
                }
              </td>
            }

            @if (isRaceOrSprint()) {
              <td class="cell-laps">{{ r.laps }}</td>

              <td class="cell-time mono">
                @if (r.status === 'Disqualified') {
                  <span class="badge-dq">DSQ</span>
                } @else if (r.status === 'Finished' || r.status === 'Lapped' || r.status.includes('+')) {
                  <span [class.winner-time]="r.position === 1">{{ r.time }}</span>
                } @else {
                  <span class="badge-dnf">Abandon</span>
                }
              </td>

              <td class="cell-tyre">
                @if (r.tyre) {
                  <div class="pirelli-tyre" [ngClass]="getTyreClass(r.tyre)" title="{{ r.tyre }}">
                    <span class="tyre-letter">{{ getTyreLetter(r.tyre) }}</span>
                  </div>
                } @else {
                  <span>-</span>
                }
              </td>

              <td class="cell-points">
                @if (r.points > 0) { <span class="points-pill">+ {{ r.points }}</span> }
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  } @else {
    <div class="no-data">Données non disponibles pour cette session.</div>
  }
</div>
